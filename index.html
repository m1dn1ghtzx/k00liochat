async function register() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if (!user || !pass) {
    alert('username and password required');
    return;
  }
  const { data, error } = await supabase.auth.signUp({
    email: user + '@k00lio.fake', // gotta fake an email cuz supabase needs it
    password: pass,
  });
  if (error) {
    alert('register failed: ' + error.message);
  } else {
    alert('registered! pls check email (ignore, it wont send tho)');
  }
}

async function login() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if (!user || !pass) {
    alert('login failed: username and password required');
    return;
  }
  const { data, error } = await supabase.auth.signInWithPassword({
    email: user + '@k00lio.fake',
    password: pass,
  });
  if (error) {
    alert('login failed: ' + error.message);
  } else {
    currentUser = user;
    alert('logged in as ' + user);
    loadMessages();
  }
}

// also clear currentUser on logout or on page reload if not logged in

supabase.auth.onAuthStateChange((event, session) => {
  if (session && session.user) {
    // user logged in
    // get user email, set currentUser without @k00lio.fake
    currentUser = session.user.email.split('@')[0];
    loadMessages();
  } else {
    currentUser = null;
  }
});
